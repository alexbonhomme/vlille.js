/*! vlille.js - v0.2.0 - 2015-12-24 - Alexandre Bonhomme */
!function(a){function b(a){"use strict";function b(a){var b,c,d,e,f,g,h=a.childNodes[0].children||[],i=[];for(b=0,d=h.length;d>b;b+=1){for(g={},f=h[b].attributes,c=0,e=f.length;e>c;c+=1)g[f[c].name]=f[c].value;i.push(g)}return i}function c(a){var b,c,d=a.childNodes[0].children||[],e={};for(b=0,c=d.length;c>b;b+=1)e[d[b].nodeName]=d[b].innerHTML;return e}var d=function(a){return a=a||{},this};a.vlille=d,d.stations=function(){return d.requestXML(f+"xml-stations.aspx",null).then(function(a){return b(a)})},d.station=function(a){var b={borne:a};return d.requestXML(f+"xml-station.aspx",b).then(function(a){return c(a)})},d.closestStations=function(a,b){return void 0===b&&(b=3),d.stations().then(function(c){var e=c.map(function(b){var c={lat:parseFloat(b.lat),lon:parseFloat(b.lng)};return b.distance=d.haversineDistance(a,c),b}).sort(function(a,b){return a.distance-b.distance});return e.length>b&&(e.length=b),e})}}function c(a){"use strict";function b(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b+"="+a[b]);return c.join("&")}var c=a.vlille;c.requestXML=function(a,d){return new c.Promise(function(c,e){var f=new window.XMLHttpRequest,g=a;d&&(g+="?"+b(d)),f.open("GET",g),f.addEventListener("load",function(a){var b=a.target;200===b.status?c(b.responseXML):e(b)}),f.addEventListener("error",function(a){e(new Error(a))}),f.send()})}}function d(a){"use strict";var b=a.vlille;Number.prototype.toRadians=function(){return this*Math.PI/180},b.haversineDistance=function(a,b){var c,d,e,f,g,h,i=6371e3;return c=a.lat.toRadians(),d=b.lat.toRadians(),e=(b.lat-a.lat).toRadians(),f=(b.lon-a.lon).toRadians(),g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(c)*Math.cos(d)*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),i*h}}function e(a){"use strict";function b(a){var b=typeof a;if(a&&("object"===b||"function"===b)){var c=a.then;if("function"==typeof c)return c}return null}function c(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}function d(a){function e(a){l=g,m=a,n.forEach(k),n=null}function i(a){l=h,m=a,n.forEach(k),n=null}function j(a){try{var d=b(a);if(d)return void c(d.bind(a),j,i);e(a)}catch(f){i(f)}}function k(a){l===f?n.push(a):(l===g&&"function"==typeof a.onFulfilled&&a.onFulfilled(m),l===h&&"function"==typeof a.onRejected&&a.onRejected(m))}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("fn must be a function");var l=f,m=null,n=[];this.done=function(a,b){setTimeout(function(){k({onFulfilled:a,onRejected:b})},0)},this.then=function(a,b){var c=this;return new d(function(d,e){return c.done(function(b){if("function"!=typeof a)return d(b);try{return d(a(b))}catch(c){return e(c)}},function(a){if("function"!=typeof b)return e(a);try{return d(b(a))}catch(c){return e(c)}})})},c(a,j,i)}var e=a.vlille,f=0,g=1,h=2;e.Promise=d}var f="http://localhost:8001/",g=function(a){"use strict";return b(a),c(a),d(a),e(a),a.vlille};"function"==typeof define&&define.amd?define(function(){"use strict";return g({})}):g(this)}(this);