/*! vlille.js - v0.1.0 - 2015-12-24 - Alexandre Bonhomme */
!function(a){function b(a){"use strict";function b(a){var b,c,d,e,f,g,h=a.childNodes[0].children||[],i=[];for(b=0,d=h.length;d>b;b+=1){for(g={},f=h[b].attributes,c=0,e=f.length;e>c;c+=1)g[f[c].name]=f[c].value;i.push(g)}return i}function c(a){var b,c,d=a.childNodes[0].children||[],e={};for(b=0,c=d.length;c>b;b+=1)e[d[b].nodeName]=d[b].innerHTML;return e}var d=function(a){return a=a||{},this};a.vlille=d,d.stations=function(){return{then:function(a,c){var f=function(c){a(b(c))};d.requestXML(e+"xml-stations.aspx",null,f,c)}}},d.station=function(a){var b={borne:a};return{then:function(a,f){var g=function(b){a(c(b))};d.requestXML(e+"xml-station.aspx",b,g,f)}}},d.losestStations=function(a,b){function c(c,e){d.stations().then(function(e){var f=e.map(function(b){var c={lat:parseFloat(b.lat),lon:parseFloat(b.lng)};return b.distance=d.haversineDistance(a,c),b}).sort(function(a,b){return a.distance-b.distance});f.length>b&&(f.length=b),c(f)},e)}return void 0===b&&(b=3),{then:c}}}function c(a){"use strict";function b(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b+"="+a[b]);return c.join("&")}var c=a.vlille;c.requestXML=function(a,c,d,e){var f=new XMLHttpRequest,g=a;c&&(g+="?"+b(c)),f.open("GET",g),f.addEventListener("load",function(a){var b=a.target;200===b.status?d(b.responseXML):e(b)}),f.addEventListener("error",function(a){e(new Error(a))}),f.send()}}function d(a){"use strict";var b=a.vlille;Number.prototype.toRadians=function(){return this*Math.PI/180},b.haversineDistance=function(a,b){var c,d,e,f,g,h,i=6371e3;return c=a.lat.toRadians(),d=b.lat.toRadians(),e=(b.lat-a.lat).toRadians(),f=(b.lon-a.lon).toRadians(),g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(c)*Math.cos(d)*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),i*h}}var e="http://localhost:8001/",f=function(a){"use strict";return b(a),c(a),d(a),a.vlille};"function"==typeof define&&define.amd?define(function(){return f({})}):f(this)}(this);