/*! vlille.js - v0.3.1 - 2016-07-26 - Alexandre Bonhomme */
!function(a){function b(a){"use strict";function b(a){if(!(this instanceof b))return new b(a);if(a=a||{},!a.apiProxyUrl)throw new Error("You have to provide a proxy URL.");return this.apiProxyBase="/"===a.apiProxyUrl.substr(-1)?a.apiProxyUrl:a.apiProxyUrl+"/",this}function c(a){var b,c,d,e,f,g,h=a.childNodes[0].children||[],i=[];for(b=0,d=h.length;d>b;b+=1){for(g={},f=h[b].attributes,c=0,e=f.length;e>c;c+=1)g[f[c].name]=f[c].value;i.push(g)}return i}function d(a){var b,c,d=a.childNodes[0].children||[],e={};for(b=0,c=d.length;c>b;b+=1)e[d[b].nodeName]=d[b].innerHTML;return e}a.Vlille=b,b.prototype.stations=function(){return b.requestXML(this.apiProxyBase+"xml-stations.aspx",null).then(function(a){return c(a)})},b.prototype.station=function(a){var c={borne:a};return b.requestXML(this.apiProxyBase+"xml-station.aspx",c).then(function(a){return d(a)})},b.prototype.closestStations=function(a,c){return void 0===c&&(c=3),this.stations().then(function(d){var e=d.map(function(c){var d={lat:parseFloat(c.lat),lon:parseFloat(c.lng)};return c.distance=b.haversineDistance(a,d),c}).sort(function(a,b){return a.distance-b.distance});return e.length>c&&(e.length=c),e})}}function c(a){"use strict";function b(a){var b,c=[];for(b in a)a.hasOwnProperty(b)&&c.push(b+"="+a[b]);return c.join("&")}var c=a.Vlille;c.requestXML=function(a,d){return new c.Promise(function(c,e){var f=new window.XMLHttpRequest,g=a;d&&(g+="?"+b(d)),f.open("GET",g),f.addEventListener("load",function(a){var b=a.target;200===b.status?c(b.responseXML):e(b)}),f.addEventListener("error",function(a){e(new Error(a))}),f.send()})}}function d(a){"use strict";var b=a.Vlille;Number.prototype.toRadians=function(){return this*Math.PI/180},b.haversineDistance=function(a,b){var c,d,e,f,g,h,i=6371e3;return c=a.lat.toRadians(),d=b.lat.toRadians(),e=(b.lat-a.lat).toRadians(),f=(b.lon-a.lon).toRadians(),g=Math.sin(e/2)*Math.sin(e/2)+Math.cos(c)*Math.cos(d)*Math.sin(f/2)*Math.sin(f/2),h=2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)),i*h}}function e(a){"use strict";function b(a){var b=typeof a;if(a&&("object"===b||"function"===b)){var c=a.then;if("function"==typeof c)return c}return null}function c(a,b,c){var d=!1;try{a(function(a){d||(d=!0,b(a))},function(a){d||(d=!0,c(a))})}catch(e){if(d)return;d=!0,c(e)}}function d(a){function e(a){l=g,m=a,n.forEach(k),n=[]}function i(a){l=h,m=a,n.forEach(k),n=[]}function j(a){try{var d=b(a);if(d)return void c(d.bind(a),j,i);e(a)}catch(f){i(f)}}function k(a){l===f?n.push(a):(l===g&&"function"==typeof a.onFulfilled&&a.onFulfilled(m),l===h&&"function"==typeof a.onRejected&&a.onRejected(m))}if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof a)throw new TypeError("fn must be a function");var l=f,m=null,n=[];this.done=function(a,b){setTimeout(function(){k({onFulfilled:a,onRejected:b})},0)},this.then=function(a,b){var c=this;return new d(function(d,e){return c.done(function(b){if("function"!=typeof a)return d(b);try{return d(a(b))}catch(c){return e(c)}},function(a){if("function"!=typeof b)return e(a);try{return d(b(a))}catch(c){return e(c)}})})},c(a,j,i)}var e=a.Vlille,f=0,g=1,h=2;e.Promise=d}var f=function(a){"use strict";return b(a),c(a),d(a),e(a),a.vlille};"function"==typeof define&&define.amd?define(function(){"use strict";return f({})}):f(this)}(this);